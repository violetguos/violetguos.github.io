{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/neural-net-raw/","result":{"data":{"avatar":null,"site":{"siteMetadata":{"title":"Violet Guo","siteUrl":"https://violetguos.github.io","author":{"name":"Violet Guo","info":"machine learning, swe"}}},"markdownRemark":{"id":"fbb4340d-6a85-5652-b727-d78997abec4b","excerpt":"Before neural netowrk frameworks were released, there was no effective way to automatically run gradient descent, defined model layer dimension, or initialize…","html":"<p>Before neural netowrk frameworks were released, there was no effective way to automatically run gradient descent, defined model layer dimension, or initialize weights. All these features are baked into Tensorflow and Pytorch.</p>\n<p>In a world without any neural network frameworks, we need to understand the fundamentals of a fully connected layer (aka MLP, neural network).</p>\n<p>The following example assumes that we use the MNIST dataset.</p>\n<h1>fully connected layer</h1>\n<p>A matrix represents an image of a digit, and each cell is a pixel value. The image has dimension n by d.</p>\n<p>Before passing through the activation function, we need to multiply the input by the weight and add the bias offset.</p>\n<p>Mathmatically, it is represented like so</p>\n<p>Wx^T + b</p>\n<p>W: dh by d, where dh is the dimension of the hidden layer\nx: n by d\nb: dh by n</p>\n<p>which yields a dh by n matrix.</p>\n<p>The activation is applied per element of the matrix</p>\n<pre class=\"grvsc-container quiet-light grvsc-ps-tuw09S\" data-language=\"python\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-11\">def</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-10\">relu</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">    Relu using only numpy.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">    </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    relu_output </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">zeros</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">shape</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    relu_flat </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> relu_output</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">flatten</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-10 grvsc-tuw09S-11\">for</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> i</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> neuron </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">in</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-11\">enumerate</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">flatten</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">()):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-10 grvsc-tuw09S-11\">if</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> neuron </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">&gt;</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">0</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">            relu_flat</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">[</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">i</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">]</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> neuron</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    relu_output </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> relu_flat</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">reshape</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">shape</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-10 grvsc-tuw09S-11\">return</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> relu_output</span></span></span></code></pre>\n<p>The output after activation retains the same input matrix dimenion, in this case dh by n</p>\n<h1>weight initialization</h1>\n<p>If we initialized all the weights to 0, backpropogation will always be 0. There is nothing to learn.</p>\n<p>Instead, a simple and effective initialization uses the hidden layer dimensions, and samples a matrix from a normal distribution, with the value bounded by the square root of $\\frac{6}{sum of layer dimensions}$</p>\n<pre class=\"grvsc-container quiet-light grvsc-ps-tuw09S\" data-language=\"python\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-11\">def</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-10\">glorot_init</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">d</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">dh1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">dh2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">m</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    dl_1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">sqrt</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">((</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">6</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">/</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">d </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">+</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> dh1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    W_1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">random</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">uniform</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">((</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">dl_1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> dl_1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">dh1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> d</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-10 grvsc-tuw09S-11\">return</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> W_1</span></span></span></code></pre>\n<p>The intuition behind this design is the forward propagation Wx^T + b will sum over every row in W, so having the layer’s dimension in the denominator will prevent the result Wx^T from exploding.</p>\n<h1>Output</h1>\n<p>Typically, we use softmax function to essentially <em>cast</em> a set of values into a probability distribution.\nThe output will retain the shape of the input to softmax, and each value can be interpreted as a probability.\nThe index of the maximum probability is the index of the predicted category.</p>\n<pre class=\"grvsc-container quiet-light grvsc-ps-tuw09S\" data-language=\"python\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-11\">def</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-10\">softmax</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">    Numerically stable because subtracting the max value makes bit overflow impossible,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">    we will only have non-positive values in the vector</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">    </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    exps </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">exp</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">pre_activation </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">max</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">pre_activation</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-10 grvsc-tuw09S-11\">return</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> exps </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">/</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">sum</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">exps</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span></code></pre>\n<h1>Backpropagation</h1>\n<p>The probability of an image of handwritten “1” to be 1 should be 100%.\nWe want to maximize this probability. Since we have the softmax representation from the forward propagation’s output, we want to maximize the softmax, aka we want softmax of the correct class to equal 1.</p>\n<p>The following will require you thinking like a true mathematician. In order to maximize this probaility, we can minimize negative of the log-likelihood to achieve the same effect.</p>\n<p>We don’t have a magically formula to find the weight values to minimize the negative log likehood. Instead, we modify the values so we move closer to the minimum log likelihood iteration by iteration. This can be done using gradient descent. For every iteration, we update the value of the weights by the value of this gradient.\nIf you are interested in the derivations, visit <a href=\"https://www.highonscience.com/blog/2021/06/18/ml-loss-function-cheat-sheet/#log-loss\">this blog</a></p>\n<pre class=\"grvsc-container quiet-light grvsc-ps-tuw09S\" data-language=\"python\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-11\">def</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-10\">backprop</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">batch_data</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">batch_target</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        dimensions:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        o_s: m x1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_oa : m x 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        hs: dh x 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_w2: m x dh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_oa: m x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_b2: m x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_oa: m x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        W(2): m x dh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_hs: dh x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_oa: m x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_ha: dh x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        x : n x d</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_W1: dh x d</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_ha: dh x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        grad_b1: dh x n</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-4 grvsc-tuw09S-8\">        </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-8\">&#39;&#39;&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_oa </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">o_s </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> batch_target</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-3 grvsc-tZ0ymb-i grvsc-tuw09S-4\"># hidden layer 3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">outer</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_oa</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">h_s2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">T</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_oa</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_hs2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">dot</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">W_3</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">T</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_oa</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        h_a_stack2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">where</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">h_a2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">&gt;</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">0</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">0</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">multiply</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_hs2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> h_a_stack2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">outer</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">h_s1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">T</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_hs1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">dot</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">W_2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">T </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha2</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        h_a_stack1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">where</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">h_a1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">&gt;</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">0</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-3\">0</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">multiply</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_hs1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> h_a_stack1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-3 grvsc-tZ0ymb-i grvsc-tuw09S-4\"># hidden layer 1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> np</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">outer</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha1</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">,</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> batch_data</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_ha1</span></span></span></code></pre>\n<p>After we obtained the gradients for each layer, we apply the <em>descent</em> by subtracting it from the weights. The learning rate serves as a control, and can be designed to be adaptive according to the shape of the loss function to accelerate or decelrate the descent.</p>\n<pre class=\"grvsc-container quiet-light grvsc-ps-tuw09S\" data-language=\"python\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">    </span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-11\">def</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-9 grvsc-tZ0ymb-b grvsc-tuw09S-10\">update_weights</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">(</span><span class=\"grvsc-tZ0ymb-7 grvsc-tuw09S-3\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">W_1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">W_2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">W_3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_W3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">b_1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b1 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">b_2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b2 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">        </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">b_3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">-=</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">grad_b3 </span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-15\">*</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\"> </span><span class=\"grvsc-tZ0ymb-5 grvsc-tuw09S-13\">self</span><span class=\"grvsc-tZ0ymb-6 grvsc-tuw09S-1\">.</span><span class=\"grvsc-tZ0ymb-1 grvsc-tuw09S-1\">learning_rate</span></span></span></code></pre>\n<p>The update is performed for every single image (aka our input data) over a number of times. Each complete set is referred to as an epoch. The number of epoch is usually determined at run time using early stopping. There is no consensus on how many epochs to run, and more isn’t always better.</p>\n<p>There is probably no occasion where we will actually write everything using numpy and pretend we don’t have tensorflow or pytorch. This post aims to provide some visbility into a simple neural network training works, and why the frameworks are appreciated in the ML community.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .quiet-light { background-color: #F5F5F5; }\n  .quiet-light .grvsc-tZ0ymb-i { font-style: italic; }\n  .quiet-light .grvsc-tZ0ymb-b { font-weight: bold; }\n  .quiet-light .grvsc-tZ0ymb-7 { color: #7A3E9D; }\n  .quiet-light .grvsc-tZ0ymb-1 { color: #333333; }\n  .quiet-light .grvsc-tZ0ymb-9 { color: #AA3731; }\n  .quiet-light .grvsc-tZ0ymb-6 { color: #777777; }\n  .quiet-light .grvsc-tZ0ymb-4 { color: #448C27; }\n  .quiet-light .grvsc-tZ0ymb-10 { color: #4B69C6; }\n  .quiet-light .grvsc-tZ0ymb-5 { color: #9C5D27; }\n  .quiet-light .grvsc-tZ0ymb-3 { color: #AAAAAA; }\n  .quiet-light .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  div#dark .grvsc-ps-tuw09S {\n    background-color: #1e1e1e;\n    color: #c5c8c6;\n  }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-11 { color: #9872A2; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-1 { color: #C5C8C6FF; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-10 { color: #CE6700; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-3 { color: #6089B4; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-8 { color: #9AA83A; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-15 { color: #676867; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-13 { color: #C7444A; }\n  div#dark .grvsc-ps-tuw09S .grvsc-tuw09S-4 { color: #9A9B99; }\n  div#dark .grvsc-ps-tuw09S .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"A World without Tensorflow or Pytorch","category":["machine learning"],"date":"03 May 2024","coverImage":{"publicURL":"/static/fcf07ef82aeaf9e4823bfacba1bf91da/dogscience.png","childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABE0lEQVQY0z1PO07DQBTca3ABam5ASYtEQ0tJOEAQBULQuSEUlBESQtDQpbCAbsGywTgFBQSUFLENG39iL0u8ztq7Ng9LZKp5n5l5D8VxnKapLAslJefcdV3GmJRSKUUp9Twvy7K6gRCCkEnG54sSFUVR/wN4WZayAYhhbBgG6PM8T5IEXIA89C57p3sD80ZVNYLtuqrI23PBmWzSQLnwjqIIY2zbtmma47H7+tI/2FprraCj9eUZowiCKiWNq5PEH4Lg/Ky7225rmtbpHBPyBR3LssDF9/3pNOmbeL+1ubO6dLi98UNjBAP4NiSfOZ/ByUEQ3N3+4R7jb0rDMNR13XEcuH80Glbg9fh0fdEdvH8IMf8FkhsChzTQ4/IAAAAASUVORK5CYII=","aspectRatio":4.016393442622951,"src":"/static/fcf07ef82aeaf9e4823bfacba1bf91da/c5cc7/dogscience.png","srcSet":"/static/fcf07ef82aeaf9e4823bfacba1bf91da/316fe/dogscience.png 245w,\n/static/fcf07ef82aeaf9e4823bfacba1bf91da/6a537/dogscience.png 490w,\n/static/fcf07ef82aeaf9e4823bfacba1bf91da/c5cc7/dogscience.png 980w,\n/static/fcf07ef82aeaf9e4823bfacba1bf91da/f1ab0/dogscience.png 1470w,\n/static/fcf07ef82aeaf9e4823bfacba1bf91da/96a87/dogscience.png 1960w,\n/static/fcf07ef82aeaf9e4823bfacba1bf91da/26c64/dogscience.png 4134w","sizes":"(max-width: 980px) 100vw, 980px"}}}},"fields":{"slug":"/neural-net-raw/","readingTime":{"text":"5 min read"}}},"previous":{"fields":{"slug":"/tree-data/"},"frontmatter":{"title":"Writing Good Code vs Training More Models"}},"next":{"fields":{"slug":"/margin-note-llama/"},"frontmatter":{"title":"What MLEs can learn from the LLaMA Paper About Efficient LLM Models"}},"webmention":{"nodes":[]}},"pageContext":{"slug":"/neural-net-raw/","previousPostId":"f87661f7-e2a5-59aa-9ac5-88a36701a452","nextPostId":"8885d531-3507-577f-8c18-a6c8c7036b3d","permalink":"https://violetguos.github.ioblog/neural-net-raw/"}},"staticQueryHashes":["2652830850","2841359383","287504094","3255793931"]}